events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    server {
        listen       9090;
        server_name  localhost;
        root         /app/data;
        
        # Настройки для WebDAV
        dav_methods  PUT DELETE;
        dav_access   user:rw group:rw all:r;
        
        # Важно: создание временных файлов в директории с правами nginx
        client_body_temp_path /tmp/nginx_client_body;
        client_max_body_size 1M;
        
        location ~ ^/(homework|last_schedule)\.json$ {
            # CORS headers
            add_header Access-Control-Allow-Origin * always;
            add_header Access-Control-Allow-Methods "GET, PUT, DELETE, OPTIONS" always;
            add_header Access-Control-Allow-Headers "Content-Type" always;
            add_header Content-Type application/json always;
            
            # OPTIONS preflight
            if ($request_method = OPTIONS) {
                return 204;
            }
            
            # Автоматическое создание файла если не существует
            dav_methods PUT DELETE;
            create_full_put_path on;
            dav_access user:rw group:rw all:r;
        }
    }
}
